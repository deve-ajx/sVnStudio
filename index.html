<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EmAji Phones Store</title>

<style>
body{font-family:Arial;background:#111;color:white;margin:0;padding:20px}
button{padding:10px;margin-top:10px;cursor:pointer}
.card{background:#222;padding:15px;margin:15px 0;border-radius:8px}
img,video{max-width:100%;border-radius:6px;margin-top:10px}
#adminPanel{display:none;margin-top:20px}
</style>
</head>
<body>

<h1>EmAji Phones Store</h1>

<button onclick="adminLogin()">Admin Login</button>

<div id="adminPanel">
<h3>Admin Panel</h3>

<textarea id="postText" placeholder="Write something..." style="width:100%;height:80px;"></textarea><br>

<input type="file" id="mediaFile"><br>

<button onclick="createPost()">Post</button>

<hr>
<h3>Your Posts</h3>
<div id="adminPosts"></div>
</div>

<hr>
<h2>Latest Updates</h2>
<div id="publicPosts"></div>


<script type="module">

// ðŸ”¥ FIREBASE CONFIG
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBMwONrab6VFm2126UCdzuOYj-82gg0LQY",
  authDomain: "emajiphones.firebaseapp.com",
  projectId: "emajiphones",
  messagingSenderId: "307215362445",
  appId: "1:307215362445:web:97ab2353692b2e9ba775c4"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ðŸ” ADMIN LOGIN
window.adminLogin = function(){
  const email = prompt("Enter admin email:");
  const password = prompt("Enter password:");

  signInWithEmailAndPassword(auth,email,password)
  .then(()=>{
    alert("Login successful");
  })
  .catch(err=>{
    alert("Login failed: " + err.message);
  });
};

// Keep admin logged in
onAuthStateChanged(auth,user=>{
  if(user){
    document.getElementById("adminPanel").style.display="block";
    loadPosts();
  }
});

// ðŸš€ CREATE POST
window.createPost = async function(){

  const text = document.getElementById("postText").value;
  const file = document.getElementById("mediaFile").files[0];

  let mediaUrl = "";
  let mediaType = "";

  try{

    // ðŸŸ¢ Upload to Cloudinary if file selected
    if(file){

      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", "emajiphones");

      const response = await fetch("https://api.cloudinary.com/v1_1/dm6k0etap/auto/upload",{
        method:"POST",
        body:formData
      });

      const data = await response.json();

      mediaUrl = data.secure_url;
      mediaType = file.type.startsWith("video") ? "video" : "image";
    }

    // ðŸ”¥ Save to Firestore
    await addDoc(collection(db,"posts"),{
      text:text,
      mediaUrl:mediaUrl,
      mediaType:mediaType,
      createdAt:serverTimestamp()
    });

    alert("Post created!");

    document.getElementById("postText").value="";
    document.getElementById("mediaFile").value="";

    loadPosts();

  }catch(error){
    alert("Error: " + error.message);
  }
};


// ðŸ“¥ LOAD POSTS
async function loadPosts(){

  const publicDiv = document.getElementById("publicPosts");
  const adminDiv = document.getElementById("adminPosts");

  publicDiv.innerHTML="";
  adminDiv.innerHTML="";

  const q = query(collection(db,"posts"),orderBy("createdAt","desc"));
  const snapshot = await getDocs(q);

  snapshot.forEach(docSnap=>{

    const data = docSnap.data();

    const card = document.createElement("div");
    card.className="card";

    if(data.mediaUrl){
      if(data.mediaType==="video"){
        card.innerHTML += `<video src="${data.mediaUrl}" controls></video>`;
      }else{
        card.innerHTML += `<img src="${data.mediaUrl}">`;
      }
    }

    card.innerHTML += `<p>${data.text}</p>`;

    publicDiv.appendChild(card);

    // ADMIN DELETE BUTTON
    const adminCard = card.cloneNode(true);
    const delBtn = document.createElement("button");
    delBtn.textContent="Delete";
    delBtn.onclick=async()=>{
      await deleteDoc(doc(db,"posts",docSnap.id));
      loadPosts();
    };

    adminCard.appendChild(delBtn);
    adminDiv.appendChild(adminCard);
  });
}

loadPosts();

</script>
</body>
</html>