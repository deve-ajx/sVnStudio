<!DOCTYPE html>
<html>
<head>
  <title>Admin Firebase Website</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, textarea { display: block; margin: 10px 0; width: 300px; }
    button { margin: 5px 0; }
    #adminPanel { border: 1px solid #ccc; padding: 10px; margin: 20px 0; }
    img { margin-top: 10px; }
  </style>
</head>
<body>

<h1>Welcome to the Website</h1>

<!-- Login Panel -->
<div id="loginPanel">
  <h2>Admin Login</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login(email.value, password.value)">Login as Admin</button>
</div>

<!-- Admin Panel -->
<div id="adminPanel" style="display:none">
  <h2>Admin Panel</h2>
  <input type="text" id="postTitle" placeholder="Post Title">
  <textarea id="postText" placeholder="Post Text"></textarea>
  <input type="file" id="postImage">
  <button onclick="addPost(postTitle.value, postText.value, postImage.files[0])">Post</button>
  <button onclick="logout()">Logout</button>
</div>

<!-- Posts -->
<h2>All Posts</h2>
<div id="postsContainer"></div>

<script type="module">
  // Import Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, orderBy, query, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-storage.js";

  // --- Your Firebase config ---
  const firebaseConfig = {
    apiKey: "AIzaSyDPlWotio-IeW2Y7b4LM0nkGansWG6zOh4",
    authDomain: "emaji-phones-store.firebaseapp.com",
    projectId: "emaji-phones-store",
    storageBucket: "emaji-phones-store.firebasestorage.app",
    messagingSenderId: "160691936362",
    appId: "1:160691936362:web:242c4dd46a53b8d2223e13"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // --- Admin email ---
  const ADMIN_EMAIL = "aliemaji01@gmail.com";

  // --- LOGIN ---
  async function login(email, password){
    try{
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      if(userCredential.user.email !== ADMIN_EMAIL){
        alert("Not authorized!");
        signOut(auth);
        return;
      }
      alert("Logged in as admin!");
      document.getElementById('adminPanel').style.display = 'block';
    }catch(error){
      alert(error.message);
    }
  }

  // --- LOGOUT ---
  function logout(){
    signOut(auth);
    document.getElementById('adminPanel').style.display = 'none';
  }

  // --- ADD POST ---
  async function addPost(title, text, file){
    try{
      let imageUrl = "";
      if(file){
        const imageRef = ref(storage, 'posts/' + file.name);
        await uploadBytes(imageRef, file);
        imageUrl = await getDownloadURL(imageRef);
      }
      await addDoc(collection(db, 'posts'), {
        title,
        text,
        imageUrl,
        createdAt: serverTimestamp()
      });
      alert("Post added!");
      loadPosts();
    }catch(error){
      alert(error.message);
    }
  }

  // --- DELETE POST ---
  async function deletePost(postId){
    try{
      await deleteDoc(doc(db, 'posts', postId));
      alert("Post deleted!");
      loadPosts();
    }catch(error){
      alert(error.message);
    }
  }

  // --- LOAD POSTS ---
  async function loadPosts(){
    const q = query(collection(db, 'posts'), orderBy('createdAt','desc'));
    const snapshot = await getDocs(q);
    const container = document.getElementById('postsContainer');
    container.innerHTML = "";
    snapshot.forEach(docSnap => {
      const post = docSnap.data();
      container.innerHTML += `
        <div>
          <h3>${post.title}</h3>
          <p>${post.text}</p>
          ${post.imageUrl ? `<img src="${post.imageUrl}" width="200">` : ""}
          ${auth.currentUser && auth.currentUser.email === ADMIN_EMAIL
            ? `<button onclick="deletePost('${docSnap.id}')">Delete</button>` : ""}
        </div><hr>
      `;
    });
  }

  // Refresh posts on auth change
  onAuthStateChanged(auth, user => {
    loadPosts();
  });

</script>
</body>
</html>